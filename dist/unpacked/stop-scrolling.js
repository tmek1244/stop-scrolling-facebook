(()=>{let e=!0,t=-1;window.onfocus=function(){console.log("on focus"),e=!0},window.onblur=function(){console.log("on blur"),e=!1};const o={position:"absolute",height:"100%","z-index":"100","background-color":"white",opacity:"0.98"};let n,s,i={waitForVideo:!0,returnToPreviousPosition:!0,currentCountDate:a(),timeCountToday:0,customTime:0,enableUseWithCation:!1};function a(){const e=new Date;return`${e.getDate()}-${e.getMonth()}-${e.getFullYear()}`}async function r(e,t,o=!1){for(;;){if(console.log("looking for newsfeed page"),d())console.log("newsfeed page is injected, no need to do it again");else if(n=c(),null!=n&&"true"!==n.getAttribute("ssf-injected")){if(console.log("Newsfeed found"),await t(),o)break}else console.log("Newsfeed not found");await new Promise((t=>setTimeout(t,e)))}}function c(){return n=document.querySelector("[role=main]"),n}function l(){const{pathname:e}=window.location;return e.startsWith("/groups/")||e.startsWith("/events/")}function u(){if(l())return!1;const e=c();return null!=e&&"true"===e.getAttribute("ssf-injected")&&e.is(":visible")}function d(){const e=c();return null!=e&&"true"===e.getAttribute("ssf-injected")}function p(){const t={};e&&(i.currentCountDate===a()?"number"==typeof i.timeCountToday?t.timeCountToday=i.timeCountToday+12:t.timeCountToday=12:(t.currentCountDate=a(),t.timeCountToday=0),chrome.storage.sync.set(t))}function h(){document.querySelector("html, body").animate({scrollTop:0},{duration:100})}function f(){n.querySelector("#ss-newsfeed-overlay span#scroll-time-count").innerText=Math.round(i.timeCountToday/60)}function g(e){s=setInterval(p,12e3),document.getElementById("ss-newsfeed-overlay").style.display="none",i.returnToPreviousPosition&&document.querySelector("html, body").animate({scrollTop:t},{duration:100}),console.log(`Open for ${e} secs`),setTimeout(m,1e3*e),setTimeout(w,1e3*(e-10))}async function m(){if(d()){const e=function(){document.getElementById("ss-newsfeed-overlay").style.display="block",f(),s&&clearInterval(s),u()&&(t=document.documentElement.scrollTop||document.body.scrollTop,h())},o=b();i.waitForVideo&&o?o.onpause=()=>{e(),o.onpause=null,o.pause()}:e()}}function b(){let e;return document.querySelectorAll("video").each((function(){this.paused||(e=this)})),e}async function w(){if(await u()){const e=10;let t,o=!0;const n=b();i.waitForVideo&&n?(t=`<strong>Video playing detected</strong><br/>Newsfeed will be close when video is paused or after it is ended - ${parseInt(n.duration-n.currentTime,10)} seconds remaining (click to dismiss)`,o=!1):t=`<strong>The Newsfeed will be closed in ${e} seconds (click to dismiss)</strong>`,noty({layout:"top",theme:"metroui",text:t,type:"warning",timeout:1e3*e,progressBar:o})}}chrome.storage.sync.get({waitForVideo:!0,returnToPreviousPosition:!0,currentCountDate:"1-1-1970",timeCountToday:0,customTime:0,enableUseWithCation:!1},(e=>{console.log("get data done",e),i=e,e.currentCountDate!==a()&&(console.log("SSF","Reset timer"),i.timeCountToday=0,chrome.storage.sync.set({timeCountToday:0,currentCountDate:a()}))})),chrome.storage.onChanged.addListener((e=>{console.log("storage changed",e),Object.keys(e).forEach((t=>{void 0!==e[t].newValue&&(i[t]=e[t].newValue)})),console.log("new settings",i)})),async function(){async function e(){l()?console.log("User is on group, ignore the newsfeed. Do nothing."):(n.setAttribute("ssf-injected","true"),console.log("SSF Injected"),h(),function(){let e=document.createElement("div");e.id="ss-newsfeed-overlay",e.innerHTML="<div class='ss-dialog'></div>",e.style=Object.assign(e.style,{width:n.offsetWidth,...o}),n.innerHTML=e.innerHTML;let t=0;const s=new MutationObserver((o=>{t+=o.length,o.forEach((t=>{const{removedNodes:o}=t;for(const t of o)if("ss-newsfeed-overlay"===t.id){n.prepend(e);break}})),t>=3&&(console.log("observer disconnected"),s.disconnect())}));s.observe(n,{attributes:!0,childList:!0,characterData:!0})}(),function(){const e=document.getElementById("ss-newsfeed-overlay").querySelector(".ss-dialog");e.innerHTML='\n    <h1>You\'ve been scrolling Facebook for <span id="scroll-time-count"></span> minutes today!</p>\n    <h1>You REALLY want to scroll Facebook newsfeed all day???</h1>\n    <a href="#" class="ss-open-nf" data-amount="15"><p>Nooooo! Just 15 secs :)</p></a>\n    <a href="#" class="ss-open-nf" data-amount="60"><p>Nah! Just 1 min :D</p></a>\n    <a href="#" class="ss-open-nf" data-amount="300"><p>Just 5 mins :(</p></a>\n    <hr/>\n    <div id="use-with-caution" style="display: none">\n      <p><strong>USE WITH CAUTION</strong></p>\n      <a href="#" class="ss-open-nf" data-amount="600"><p>I NEED 10 MINUTES !</p></a>\n      <a href="#" class="ss-open-nf" data-amount="1800"><p>I WANT MORE. GIVE ME 30 MINUTES !!!</p></a>\n      <a href="#" class="ss-open-nf-custom"><p>GIVE ME X MINUTES (CUSTOM)</p></a>\n      <hr/>\n    </div>\n    <p><strong>Settings</strong></p>\n    <div><label><input type="checkbox" id="wait-for-video"><span>Wait for playing video to pause/stop before closing newsfeed</span></label></div>\n    <div><label><input type="checkbox" id="return-to-previous-position"><span>Auto scroll to the position before closing newsfeed</span></label></div>\n    <div><label><input type="checkbox" id="enable-use-with-caution"><span class="enable-longer-time-options">Enable longer time and customizable options</span></label></div>\n    <hr/>\n    <p><strong>Coming Features</strong></p>\n    <ul>\n      <li> - Wait if users are posting comments</li>\n    </ul>\n    <a href="https://chrome.google.com/webstore/detail/stop-scrolling-newsfeed-f/nhcbjhbdnlkddnapaoidpkfbjkpkpdcj/support" target="_blank">\n      <p>Want new feature? Click here!</p>\n    </a>\n    <hr/>\n    <strong>Helpful links</strong>\n    <a href="https://chrome.google.com/webstore/detail/stop-scrolling-newsfeed-f/nhcbjhbdnlkddnapaoidpkfbjkpkpdcj/reviews" target="_blank">\n      <p>Rate this application ★★★★★</p>\n    </a>\n    <a href="https://www.paypal.com/cgi-bin/webscr?cmd=_donations&business=TDLNJGZJ24FBA&item_name=Buy+developer+of+Stop+Scrolling+Facebook+a+coffee&currency_code=USD&source=url" target="_blank">\n      <p>Like this extension? Buy me a coffee!</p>\n    </a>\n    <a href="https://chrome.google.com/webstore/detail/stop-scrolling-newsfeed-f/nhcbjhbdnlkddnapaoidpkfbjkpkpdcj/support" target="_blank">\n      <p>Ask for support or tell us your suggestion to make this application better</p>\n    </a>\n    <a href="https://github.com/tobernguyen/stop-scrolling-facebook" target="_blank">\n      <p>Contribute to this open-source project or star it if you like!</p>\n    </a>\n    <a href="https://github.com/tobernguyen/stop-scrolling-facebook/blob/master/CHANGELOG.md" target="_blank">\n      <p>Change log</p>\n    </a>\n  ',e.querySelector(".ss-open-nf-custom").click((()=>{const e=Number(window.prompt("How many minutes do you want?",i.customTime||""));e<=0?window.alert("Invalid. Must be greater than 0 minutes."):(g(60*e),i.customTime=e,chrome.storage.sync.set({customTime:e}))})),e.querySelector(".ss-open-nf").each((function(){this.addEventListener("click",(()=>{g(parseInt(this.dataset.amount))}))})),f();const t=e.getElementById("wait-for-video");t.setAttribute("checked",i.waitForVideo),t.addEventListener("change",(()=>{i.waitForVideo=t.checked,chrome.storage.sync.set({waitForVideo:t.checked})}));const o=e.getElementById("return-to-previous-position");o.setAttribute("checked",i.returnToPreviousPosition),o.addEventListener("change",(()=>{i.returnToPreviousPosition=o.checked,chrome.storage.sync.set({returnToPreviousPosition:o.checked})}));const n=e.getElementById("enable-use-with-caution");n.setAttribute("checked",i.enableUseWithCation),n.addEventListener("change",(()=>{i.enableUseWithCation?(alert("You made a right choice, and also a brave choice ;) But it will be definitely worth it!"),chrome.storage.sync.set({enableUseWithCation:!1},(()=>window.location.reload()))):window.confirm("!!!CAUTION!!!\n\nThis is a VERY VERY VERY DANGEROUS option. You will definitely SPEND MORE TIME on Facebook. Are you sure to do this?")?chrome.storage.sync.set({enableUseWithCation:!0},(()=>window.location.reload())):n.setAttribute("checked",i.enableUseWithCation)})),i.enableUseWithCation&&e.getElementById("use-with-caution").show()}())}console.log("Start watching for newsfeed page"),await r(50,e,!0),await r(1e3,e)}()})();